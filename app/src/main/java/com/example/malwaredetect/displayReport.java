package com.example.malwaredetect;

import android.os.Bundle;
import android.widget.TextView;


import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import androidx.viewpager.widget.ViewPager;

import com.google.android.material.tabs.TabLayout;

import org.json.JSONObject;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

public class displayReport extends AppCompatActivity{
    RecyclerView recyclerView;


    @Override
    protected void onCreate(Bundle savedInstanceState) {

        super.onCreate(savedInstanceState);
        setContentView(R.layout.displayreport);
        final TextView url=findViewById(R.id.url);
        final TextView scanDate=findViewById(R.id.scanDate);
        final TextView positives=findViewById(R.id.positives);
        final TextView total=findViewById(R.id.total);
        final TextView urltf=findViewById(R.id.urltf);
        recyclerView = (RecyclerView)findViewById(R.id.recyclerView);
                    try {
                        JSONObject jsonObj = new JSONObject(getIntent().getStringExtra("report"));
                        System.out.println("2nd page");
                        System.out.println(jsonObj.toString());
                        if(jsonObj.has("url")) {
                            url.setText(jsonObj.getString("url"));
                        }
                        else{
                            urltf.setText("Hash:");
                            url.setText(jsonObj.getString("resource"));

                        }
                        scanDate.setText(jsonObj.getString("scan_date"));
                        positives.setText(jsonObj.getString("positives"));
                        total.setText(jsonObj.getString("total"));
                        System.out.println("scans");
                        Iterator<String> iter = jsonObj.getJSONObject("scans").keys(); //This should be the iterator you want.
                        List<String> name = new ArrayList<>();
                        List<String> detected = new ArrayList<>();
                        List<String> result = new ArrayList<>();

                        while(iter.hasNext()){
                            String cur=iter.next();
                            name.add(cur);
                            detected.add(jsonObj.getJSONObject("scans").getJSONObject(cur).getString("detected"));
                            result.add(jsonObj.getJSONObject("scans").getJSONObject(cur).getString("result"));
                            //System.out.println(jsonObj.getJSONObject("scans").getJSONObject(cur).getString("detected"));
                        }
                        System.out.println(name);
                        System.out.println(detected);
                        System.out.println(result);
                        MyAdapter myAdapter=new MyAdapter(this,name,detected,result);
                        recyclerView.setAdapter(myAdapter);
                        recyclerView.setLayoutManager(new LinearLayoutManager(this));
                    }catch (Exception ex){
                        System.out.println("mmmmmmmmm");
                        System.out.println(ex);
                    }

    }

}
