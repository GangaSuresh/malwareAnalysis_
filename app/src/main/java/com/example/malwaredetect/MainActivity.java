package com.example.malwaredetect;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;

import com.androidnetworking.AndroidNetworking;
import com.androidnetworking.common.Priority;
import com.androidnetworking.error.ANError;
import com.androidnetworking.interfaces.JSONArrayRequestListener;
import com.androidnetworking.interfaces.JSONObjectRequestListener;

import org.json.JSONArray;
import org.json.JSONObject;

public class MainActivity extends AppCompatActivity implements AdapterView.OnItemSelectedListener {
    final String xApiToken = "9d33d694124645e5adab01d4d2e284625320350e5008140ac72b234c675f4e0f";
    final String xLinkScanUrl = "https://www.virustotal.com/vtapi/v2/url/scan";
    //get the spinner from the xml.
    String[] items = new String[]{"URL", "FILE"};

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        AndroidNetworking.initialize(getApplicationContext());
        final EditText et=findViewById(R.id.editText2);
        //final TextView tv=findViewById(R.id.textView3);
        Button scan=findViewById(R.id.button);
        Spinner spinner = (Spinner)findViewById(R.id.spinner);
        ArrayAdapter<String>adapter = new ArrayAdapter<String>(MainActivity.this, android.R.layout.simple_spinner_item,items);
        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        spinner.setAdapter(adapter);
        spinner.setOnItemSelectedListener(this);

        //button
        scan.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                AndroidNetworking.post(
                        "https://www.virustotal.com/vtapi/v2/url/scan").addBodyParameter("apikey","3f31f8d6c30a8a2730d77f076f5778c6be9526776bcfa98f040958da3f6e4b75")
                        .addBodyParameter("url",et.getText().toString()).setTag("test").setPriority(Priority.HIGH)
                        .build().getAsJSONObject(new JSONObjectRequestListener() {
                    @Override
                    public void onResponse(JSONObject response) {

                        System.out.println(response);
                        Toast toast = Toast.makeText(getApplicationContext(),
                                response.toString(),
                                Toast.LENGTH_SHORT);
                        try{
                        AndroidNetworking.post("https://www.virustotal.com/vtapi/v2/url/report").addBodyParameter("apikey","3f31f8d6c30a8a2730d77f076f5778c6be9526776bcfa98f040958da3f6e4b75")
                                .addBodyParameter("resource",response.get("resource").toString()).build().getAsJSONObject(new JSONObjectRequestListener() {
                            @Override
                            public void onResponse(JSONObject response1) {
                                System.out.println("**************");
                                System.out.println(response1);
                                Toast toast = Toast.makeText(getApplicationContext(),
                                        response1.toString(),
                                        Toast.LENGTH_SHORT);

                                Intent intent = new Intent(MainActivity.this,displayReport.class);
                                intent.putExtra("report", response1.toString());
                                startActivity(intent);
                            }

                            @Override
                            public void onError(ANError anError) {
                                System.out.println("eeee");
                                System.out.println(anError);
                                Toast toast = Toast.makeText(getApplicationContext(),
                                        anError.toString(),
                                        Toast.LENGTH_SHORT);
                            }
                        });}
                        catch (Exception e){
                            System.out.println("eeeeeeee");
                        }
                    }
                    @Override
                    public void onError(ANError anError) {
                        System.out.println("**************");
                        System.out.println(anError);
                        Toast toast = Toast.makeText(getApplicationContext(),
                                anError.toString(),
                                Toast.LENGTH_SHORT);
                    }
                });
//                Toast toast = Toast.makeText(getApplicationContext(),
//                        et.getText().toString(),
//                        Toast.LENGTH_SHORT);
//                toast.show();
            }
        });

    }

    @Override
    public void onItemSelected(AdapterView<?> parent, View v, int position, long id) {


        switch (position) {
            case 0:
                // Whatever you want to happen when the first item gets selected
                break;
            case 1:
                // Whatever you want to happen when the second item gets selected
                break;
        }
    }

    @Override
    public void onNothingSelected(AdapterView<?> parent) {
        // TODO Auto-generated method stub
    }
}

